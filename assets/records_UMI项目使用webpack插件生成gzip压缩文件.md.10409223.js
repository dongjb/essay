import{_ as s,o as a,c as n,O as p}from"./chunks/framework.81eb544a.js";const A=JSON.parse('{"title":"UMI项目使用webpack插件生成gzip压缩文件","description":"","frontmatter":{"title":"UMI项目使用webpack插件生成gzip压缩文件","date":"2020-07-21T10:57:36.000Z","tags":["webpack","compression-webpack-plugin","umi","react"],"categories":["前端","umi","react"]},"headers":[],"relativePath":"records/UMI项目使用webpack插件生成gzip压缩文件.md","filePath":"records/UMI项目使用webpack插件生成gzip压缩文件.md","lastUpdated":1686983617000}'),l={name:"records/UMI项目使用webpack插件生成gzip压缩文件.md"},o=p(`<h1 id="umi项目使用webpack插件生成gzip压缩文件" tabindex="-1">UMI项目使用webpack插件生成gzip压缩文件 <a class="header-anchor" href="#umi项目使用webpack插件生成gzip压缩文件" aria-label="Permalink to &quot;UMI项目使用webpack插件生成gzip压缩文件&quot;">​</a></h1><h2 id="安装插件-compression-webpack-plugin" tabindex="-1">安装插件 compression-webpack-plugin <a class="header-anchor" href="#安装插件-compression-webpack-plugin" aria-label="Permalink to &quot;安装插件 compression-webpack-plugin&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">compression-webpack-plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">add</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">compression-webpack-plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-D</span></span></code></pre></div><h2 id="umi-项目配置文件" tabindex="-1">umi 项目配置文件 <a class="header-anchor" href="#umi-项目配置文件" aria-label="Permalink to &quot;umi 项目配置文件&quot;">​</a></h2><p>在配置文件.umirc.js 或者 config/config.js 文件中添加配置</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> CompressionWebpackPlugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">compression-webpack-plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> prodGzipList </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">css</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">chainWebpack</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">env</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">NODE_ENV</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">production</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 生产模式开启</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">plugin</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">compression-webpack-plugin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">CompressionWebpackPlugin</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// filename: 文件名称，这里我们不设置，让它保持和未压缩的文件同一个名称</span></span>
<span class="line"><span style="color:#F07178;">        algorithm</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">gzip</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 指定生成gzip格式</span></span>
<span class="line"><span style="color:#F07178;">        test</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\\\</span><span style="color:#C3E88D;">.(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prodGzipList</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 匹配哪些格式文件需要压缩</span></span>
<span class="line"><span style="color:#F07178;">        threshold</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">10240</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">//对超过10k的数据进行压缩</span></span>
<span class="line"><span style="color:#F07178;">        minRatio</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0.6</span><span style="color:#F07178;"> </span><span style="color:#676E95;font-style:italic;">// 压缩比例，值为0 ~ 1</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><h2 id="" tabindex="-1"><img src="http://images.dongjb.com/1595298681583-d3f320b1-9810-4f7f-b5e9-b954aafcb103.png" alt="image.png"> <a class="header-anchor" href="#" aria-label="Permalink to &quot;![image.png](http://images.dongjb.com/1595298681583-d3f320b1-9810-4f7f-b5e9-b954aafcb103.png)&quot;">​</a></h2><p>同理在 vue 项目中也可以该插件生成 gzip 文件，配置也是大同小异</p><h2 id="nginx-开启-gzip" tabindex="-1">nginx 开启 gzip <a class="header-anchor" href="#nginx-开启-gzip" aria-label="Permalink to &quot;nginx 开启 gzip&quot;">​</a></h2><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 开启和关闭gzip模式</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># gizp压缩起点，文件大于</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">k才进行压缩</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_min_length </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">k;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># gzip 压缩级别，</span><span style="color:#F78C6C;">1-9</span><span style="color:#A6ACCD;">，数字越大压缩的越好，也越占用CPU时间</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_comp_level </span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 进行压缩的文件类型。</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/xml text/javascript application/json;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># nginx对于静态文件的处理模块，开启后会寻找以.gz结尾的文件，直接返回，不会占用cpu进行压缩</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_static on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 是否在http header中添加Vary: Accept-Encoding，建议开启</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_vary on;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"># 设置压缩所需要的缓冲区大小，以</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">k为单位，如果文件为</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">k则申请</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">*</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">k的缓冲区</span></span>
<span class="line"><span style="color:#A6ACCD;">gzip_buffers </span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">16</span><span style="color:#A6ACCD;">k;</span></span></code></pre></div>`,10),e=[o];function c(t,r,i,y,D,F){return a(),n("div",null,e)}const g=s(l,[["render",c]]);export{A as __pageData,g as default};
